<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CasaShop — Loja de Casas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root{
            --primary:#0b5ed7;
            --accent:#0dcaf0;
            --dark:#081225;
            --muted:#6b7280;
            --bg:#f4f7fb;
            --glass: rgba(255,255,255,0.7);
            --card-shadow: 0 14px 36px rgba(2,6,23,0.06);
            --radius: 14px;
            --transition: 300ms cubic-bezier(.2,.9,.2,1);
        }

        *{box-sizing:border-box}
        html,body{height:100%}
        body{font-family:'Poppins',sans-serif;background:linear-gradient(180deg,#f3f8ff 0%,var(--bg) 60%);color:var(--dark);margin:0}
        a{color:var(--primary)}

        .navbar{background:linear-gradient(90deg, rgba(255,255,255,.8), rgba(255,255,255,.6));backdrop-filter: blur(6px);box-shadow: 0 8px 30px rgba(2,6,23,0.06)}
        .brand{font-weight:800;color:var(--primary);letter-spacing:.6px}

        /* Hero */
        .hero{padding:5.5rem 0 3rem}
        .hero h1{font-size:2.4rem;line-height:1.05}
        .hero .lead{color:var(--muted);max-width:48rem}
        .hero-visual{border-radius:22px;overflow:hidden;box-shadow:var(--card-shadow)}

        /* Cards */
        .card-house{border-radius:var(--radius);overflow:hidden;background:linear-gradient(180deg,white,#fbfdff);box-shadow:var(--card-shadow);transition:transform var(--transition),box-shadow var(--transition)}
        .card-house:hover{transform:translateY(-10px);box-shadow:0 30px 60px rgba(11,94,215,0.08)}
        .house-thumb{height:220px;object-fit:cover;width:100%;display:block}

        .tag{display:inline-block;padding:.28rem .65rem;border-radius:999px;background:rgba(11,94,215,0.08);color:var(--primary);font-weight:700;font-size:.78rem}

        .filters .btn{border-radius:999px}

        #mapPlaceholder{height:320px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:var(--muted);background:linear-gradient(135deg,#eaf8ff,#ffffff)}

        /* Quiz */
        .quiz-card{border-radius:14px;padding:1.25rem;background:linear-gradient(180deg,#ffffff,#fbfdff);box-shadow:var(--card-shadow)}
        .option{cursor:pointer;padding:.9rem;border-radius:10px;border:1px solid transparent;transition:all 160ms ease;user-select:none}
        .option:hover{background:#f5f9ff;transform:translateY(-2px)}
        .option.selected{border-color:var(--primary);background:linear-gradient(90deg,rgba(11,94,215,0.04),rgba(13,202,240,0.03))}
        .option.correct{background:#e6fbef;border-color:#28a745}
        .option.wrong{background:#ffefee;border-color:#dc3545}

        .progress-bar-quiz{height:10px;border-radius:999px;overflow:hidden;background:#e9f2ff}
        .progress-bar-quiz > div{height:100%;background:linear-gradient(90deg,var(--primary),var(--accent));transition:width 350ms ease}

        /* Footer */
        .footer{background:linear-gradient(180deg,#06102a,#07102a);color:#cbd5e1;padding:3.25rem 0;margin-top:3rem}

        /* Agents / Testimonials */
        .agent-card{border-radius:12px;padding:1rem;background:white;box-shadow:var(--card-shadow);text-align:center}

        @media(max-width:768px){.hero{padding:3.5rem 0}.house-thumb{height:180px}}
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container">
            <a class="navbar-brand brand" href="#">CasaShop</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navmenu">
                <ul class="navbar-nav ms-auto align-items-lg-center">
                    <li class="nav-item"><a class="nav-link" href="#homes">Casas</a></li>
                    <li class="nav-item"><a class="nav-link" href="#gallery">Galeria</a></li>
                    <li class="nav-item"><a class="nav-link" href="#quiz">Quiz</a></li>
                    <li class="nav-item"><a class="nav-link" href="#contact">Contacto</a></li>
                    <li class="nav-item ms-2 d-none d-lg-block"><a class="btn btn-outline-primary" href="#homes">Ver Casas</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="hero">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="mb-3">Encontre a casa dos seus sonhos — com estilo e confiança</h1>
                    <p class="lead">CasaShop é um protótipo moderno para apresentar listagens com imagens de alta qualidade, filtros, um quiz interativo e componentes visuais polidos. Experimente a navegação, adicione favoritos e descubra propriedades inspiradoras.</p>
                    <div class="mt-4">
                        <a href="#homes" class="btn btn-primary me-2">Explorar Casas</a>
                        <a href="#quiz" class="btn btn-outline-primary">Jogar Quiz</a>
                    </div>
                    <div class="mt-4 d-flex gap-3">
                        <div class="p-3 bg-white rounded-3" style="box-shadow:var(--card-shadow);width:140px;text-align:center">
                            <small class="text-muted">Casas</small>
                            <h4 id="statHouses">0</h4>
                        </div>
                        <div class="p-3 bg-white rounded-3" style="box-shadow:var(--card-shadow);width:140px;text-align:center">
                            <small class="text-muted">Cidades</small>
                            <h4 id="statCities">0</h4>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 mt-4 mt-lg-0">
                    <div class="hero-visual">
                        <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-indicators"></div>
                            <div class="carousel-inner"></div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Anterior</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Próximo</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="py-5" id="homes">
            <div class="container">
                <div class="row mb-4 align-items-center">
                    <div class="col-md-8">
                        <h2>Casas Disponíveis</h2>
                        <p class="text-muted">Pesquise, filtre e descubra propriedades com imagens grandes, galeria e detalhes completos.</p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <button id="openFavorites" class="btn btn-outline-secondary me-2"><i class="fa-regular fa-heart"></i> Favoritos <span id="favCount" class="badge bg-primary ms-2">0</span></button>
                    </div>
                </div>

                <div class="row mb-3 search-row align-items-center">
                    <div class="col-md-6 d-flex">
                        <input id="searchInput" class="form-control me-2" placeholder="Procurar por cidade, nome ou preço...">
                        <select id="sortSelect" class="form-select" style="max-width:180px">
                            <option value="default">Ordenar</option>
                            <option value="price-asc">Preço ↑</option>
                            <option value="price-desc">Preço ↓</option>
                            <option value="area-desc">Área ↓</option>
                        </select>
                    </div>
                    <div class="col-md-6 text-md-end filters">
                        <button class="btn btn-sm btn-outline-primary me-1 active" data-filter="all">Todos</button>
                        <button class="btn btn-sm btn-outline-primary me-1" data-filter="apartment">Apartamento</button>
                        <button class="btn btn-sm btn-outline-primary me-1" data-filter="house">Moradia</button>
                        <button class="btn btn-sm btn-outline-primary me-1" data-filter="villa">Moradia Luxo</button>
                        <button class="btn btn-sm btn-outline-primary me-1" data-filter="studio">Studio</button>
                    </div>
                </div>

                <div class="row" id="housesContainer"></div>

                <div class="row mt-5 g-4">
                    <div class="col-lg-8">
                        <h5>Localização</h5>
                        <div id="mapPlaceholder">Mapa interativo simulador (ex: Google Maps)</div>
                    </div>
                    <div class="col-lg-4">
                        <h5>Detalhes rápidos</h5>
                        <ul class="list-unstyled">
                            <li><strong>Casas listadas:</strong> <span id="totalHouses">0</span></li>
                            <li><strong>Cidades disponíveis:</strong> <span id="totalCities">0</span></li>
                            <li><strong>Mín. Preço:</strong> <span id="minPrice">—</span></li>
                            <li><strong>Máx. Preço:</strong> <span id="maxPrice">—</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="py-5 bg-white" id="gallery">
            <div class="container">
                <div class="row mb-4">
                    <div class="col-md-8">
                        <h2>Galeria Inspiradora</h2>
                        <p class="text-muted">Uma seleção de imagens para inspirar estilos e decorações.</p>
                    </div>
                </div>
                <div class="row g-3">
                    <div class="col-md-4"><img src="https://images.unsplash.com/photo-1570129477492-45c003edd2be?auto=format&fit=crop&w=1470&q=80" class="img-fluid rounded-3" loading="lazy"></div>
                    <div class="col-md-4"><img src="https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=1470&q=80" class="img-fluid rounded-3" loading="lazy"></div>
                    <div class="col-md-4"><img src="https://images.unsplash.com/photo-1505691723518-36a9c6fbe1aa?auto=format&fit=crop&w=1470&q=80" class="img-fluid rounded-3" loading="lazy"></div>
                    <div class="col-md-4"><img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=1470&q=80" class="img-fluid rounded-3" loading="lazy"></div>
                    <div class="col-md-4"><img src="https://images.unsplash.com/photo-1533099263-4a3a03c5f7f7?auto=format&fit=crop&w=1470&q=80" class="img-fluid rounded-3" loading="lazy"></div>
                    <div class="col-md-4"><img src="https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?auto=format&fit=crop&w=1470&q=80" class="img-fluid rounded-3" loading="lazy"></div>
                </div>
            </div>
        </section>

        <section class="py-5" id="quiz">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8">
                        <h2>Quiz Interativo: Teste os seus conhecimentos de JavaScript</h2>
                        <p class="text-muted">Quiz renovado com feedback imediato, barra de progresso, tempo por questão e revisão final.</p>

                        <div class="quiz-card mt-3" id="quizCard">
                            <div class="mb-3">
                                <div class="progress-bar-quiz" aria-hidden>
                                    <div id="quizProgressBar" style="width:0%"></div>
                                </div>
                                <div class="d-flex justify-content-between mt-2"><small id="quizProgress">Questão 0 / 0</small><small id="timer">--:--</small></div>
                            </div>
                            <div id="quizQuestionArea"></div>
                            <div class="mt-3 d-flex justify-content-between align-items-center">
                                <div><small id="quizHint" class="text-muted"></small></div>
                                <div>
                                    <button id="nextBtn" class="btn btn-primary btn-sm">Próxima</button>
                                    <button id="restartBtn" class="btn btn-outline-secondary btn-sm">Recomeçar</button>
                                </div>
                            </div>
                        </div>
                        <div id="confetti" aria-hidden></div>
                    </div>
                    <div class="col-lg-4 mt-4 mt-lg-0">
                        <h5>Pontuação</h5>
                        <div class="p-3 bg-light rounded-3 text-center">
                            <h3 id="score">0</h3>
                            <p class="mb-0 text-muted">Pontos</p>
                        </div>
                        <div class="mt-3">
                            <h6>Resumo</h6>
                            <ul id="quizSummary" class="list-unstyled small text-muted"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="py-5" id="contact">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6">
                        <h2>Contacto</h2>
                        <p class="text-muted">Preencha o formulário para nos contactar. O CAPTCHA é gerado e validado em JavaScript.</p>

                        <div class="card p-4" style="border-radius:12px;box-shadow:var(--card-shadow)">
                            <form id="contactForm">
                                <div class="mb-3">
                                    <input id="name" class="form-control" placeholder="Nome" required>
                                </div>
                                <div class="mb-3">
                                    <input id="email" type="email" class="form-control" placeholder="Email" required>
                                </div>
                                <div class="mb-3">
                                    <textarea id="message" class="form-control" rows="4" placeholder="Mensagem" required></textarea>
                                </div>

                                <div class="d-flex align-items-center mb-3">
                                    <div id="captchaCode" class="me-3" style="font-family:monospace;background:#fff;padding:.5rem 1rem;border-radius:8px;border:1px solid #e6eefb">AB12CD</div>
                                    <button type="button" id="refreshCaptcha" class="btn btn-outline-secondary btn-sm me-3"><i class="fa-solid fa-rotate"></i></button>
                                    <input id="captchaInput" class="form-control" placeholder="Escreva o código" style="max-width:260px" required>
                                </div>

                                <div class="d-grid">
                                    <button class="btn btn-primary" type="submit">Enviar Mensagem</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="col-lg-6 mt-4 mt-lg-0">
                        <h5>Informações</h5>
                        <p class="text-muted">CasaShop — Loja de Casas (exemplo escolar). Endereço fictício.</p>
                        <ul class="list-unstyled">
                            <li><i class="fa-regular fa-envelope me-2"></i> contacto@casashop.example</li>
                            <li><i class="fa-solid fa-phone me-2"></i> +351 900 000 000</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 CasaShop — Projeto Escolar. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Modal: House details + carousel -->
    <div class="modal fade" id="houseModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 id="modalTitle" class="modal-title">Casa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-8">
                            <div id="modalCarousel" class="carousel slide mb-3" data-bs-ride="carousel">
                                <div class="carousel-inner"></div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#modalCarousel" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#modalCarousel" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                </button>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <h5 id="modalTitleSide">Detalhes</h5>
                            <p id="modalDesc"></p>
                            <ul id="modalSpecs" class="list-unstyled"></ul>
                            <div class="d-grid mt-3">
                                <button class="btn btn-outline-secondary" id="favToggle"><i class="fa-regular fa-heart"></i> Favoritar</button>
                                <button class="btn btn-primary mt-2" data-bs-dismiss="modal">Fechar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Expanded list of houses with more images to enrich the page (many items to increase file length)
        const houses = [
            { id:1, title:'Moradia Solar', type:'house', city:'Porto', price:450000, area:220, images:[
                'https://images.unsplash.com/photo-1560185127-6c1d4b4b1d3a?auto=format&fit=crop&w=1600&q=80',
                'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=1600&q=80',
                'https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Moradia luminosa com grande jardim e painéis solares integrados, cozinha open-space e ligação a terraços.'},
            { id:2, title:'Apartamento Central', type:'apartment', city:'Lisboa', price:320000, area:95, images:[
                'https://images.unsplash.com/photo-1580587771525-78b9dba3b914?auto=format&fit=crop&w=1600&q=80',
                'https://images.unsplash.com/photo-1493809842364-78817add7ffb?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Apartamento moderno no centro, varanda ampla, próximo de transporte público.'},
            { id:3, title:'Villa do Bosque', type:'villa', city:'Faro', price:980000, area:420, images:[
                'https://images.unsplash.com/photo-1505691723518-36a9c6fbe1aa?auto=format&fit=crop&w=1600&q=80',
                'https://images.unsplash.com/photo-1533099263-4a3a03c5f7f7?auto=format&fit=crop&w=1600&q=80',
                'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Villa de luxo com piscina, cinema e vistas imbatíveis sobre o bosque.'},
            { id:4, title:'T1 Acolhedor', type:'apartment', city:'Coimbra', price:145000, area:48, images:[
                'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Pequeno apartamento ideal para estudantes ou investimento de arrendamento.'},
            { id:5, title:'Moradia do Lago', type:'house', city:'Braga', price:620000, area:300, images:[
                'https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?auto=format&fit=crop&w=1600&q=80',
                'https://images.unsplash.com/photo-1505692794400-3e1b9c6d3b6e?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Casa com acesso a lago privado, jardim paisagístico e garagem para barcos pequenos.'},
            { id:6, title:'Penthouse Vista Mar', type:'apartment', city:'Cascais', price:1250000, area:180, images:[
                'https://images.unsplash.com/photo-1523217582562-09d0def993a6?auto=format&fit=crop&w=1600&q=80',
                'https://images.unsplash.com/photo-1505691723518-36a9c6fbe1aa?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Penthouse com vista mar, terraço 360º e acabamentos premium.'},
            { id:7, title:'Studio Minimal', type:'studio', city:'Aveiro', price:98000, area:32, images:[
                'https://images.unsplash.com/photo-1505691723518-36a9c6fbe1aa?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Studio compacto com design minimalista e boa luminosidade.'},
            { id:8, title:'Quinta Tradicional', type:'house', city:'Évora', price:780000, area:1100, images:[
                'https://images.unsplash.com/photo-1472220625704-91e1462799b2?auto=format&fit=crop&w=1600&q=80',
                'https://images.unsplash.com/photo-1505691723518-36a9c6fbe1aa?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Quinta tradicional com oliveiras, adega e espaços para eventos.'},
            { id:9, title:'Casa na Costa', type:'villa', city:'Algarve', price:1450000, area:520, images:[
                'https://images.unsplash.com/photo-1484154218962-a197022b5858?auto=format&fit=crop&w=1600&q=80',
                'https://images.unsplash.com/photo-1505691723518-36a9c6fbe1aa?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Moradia de luxo com piscina infinita, jardim e acesso à praia.'},
            { id:10, title:'Apartamento Vintage', type:'apartment', city:'Porto', price:275000, area:78, images:[
                'https://images.unsplash.com/photo-1505691723518-36a9c6fbe1aa?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Apartamento com traços clássicos recuperados e muita personalidade.'},
            { id:11, title:'Loft Industrial', type:'studio', city:'Lisboa', price:410000, area:110, images:[
                'https://images.unsplash.com/photo-1493809842364-78817add7ffb?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Loft com pé direito alto, mezzanine e acabamentos industriais.'},
            { id:12, title:'Casa de Campo Moderna', type:'house', city:'Serra da Estrela', price:520000, area:260, images:[
                'https://images.unsplash.com/photo-1494526585095-c41746248156?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Refúgio de montanha, ideal para férias e aluguer sazonal.'},
            { id:13, title:'Moradia Familiar', type:'house', city:'Setúbal', price:415000, area:210, images:[
                'https://images.unsplash.com/photo-1568605114967-8130f3a36994?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Espaçosa, com áreas sociais grandes e quintal para crianças.'},
            { id:14, title:'Apartamento Novo', type:'apartment', city:'Faro', price:235000, area:68, images:[
                'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Apartamento em condomínio recente com piscina e ginásio.'},
            { id:15, title:'Casa Histórica', type:'house', city:'Bragança', price:199000, area:150, images:[
                'https://images.unsplash.com/photo-1472220625704-91e1462799b2?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Casa com elementos históricos, ideal para restauro ou projeto cultural.'},
            { id:16, title:'Villa Minimalista', type:'villa', city:'Lagos', price:890000, area:350, images:[
                'https://images.unsplash.com/photo-1505691723518-36a9c6fbe1aa?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Villa com linhas minimalistas, piscina e espaços abertos.'},
            { id:17, title:'Townhouse Urbana', type:'house', city:'Leiria', price:305000, area:160, images:[
                'https://images.unsplash.com/photo-1560185127-6c1d4b4b1d3a?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Moradia em banda, com garagem e pequeno jardim privado.'},
            { id:18, title:'Moradia Renovada', type:'house', city:'Viana do Castelo', price:365000, area:200, images:[
                'https://images.unsplash.com/photo-1523217582562-09d0def993a6?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Renovada recentemente com materiais sustentáveis.'},
            { id:19, title:'Apartamento Estúdio', type:'studio', city:'Funchal', price:122000, area:36, images:[
                'https://images.unsplash.com/photo-1493809842364-78817add7ffb?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Estúdio com vista para o mar, ideal para investimento.'},
            { id:20, title:'Casa de Praia', type:'house', city:'Vila Nova de Milfontes', price:450000, area:140, images:[
                'https://images.unsplash.com/photo-1484154218962-a197022b5858?auto=format&fit=crop&w=1600&q=80'
            ], desc:'Casa perto da praia com acesso direto e espaço para hóspedes.'}
        ];

        // Initialize hero carousel with first featured houses
        (function initHero(){
            const carousel = document.querySelector('#heroCarousel .carousel-inner');
            const indicators = document.querySelector('#heroCarousel .carousel-indicators');
            houses.slice(0,5).forEach((h,i)=>{
                const item = document.createElement('div');
                item.className = 'carousel-item'+(i===0? ' active':'');
                item.innerHTML = `
                    <img src="${h.images[0]}" class="d-block w-100" style="height:360px;object-fit:cover" loading="lazy">
                    <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-25 rounded-3 p-3">
                        <h5>${h.title}</h5>
                        <p class="mb-0">${h.city} — €${h.price.toLocaleString()}</p>
                    </div>
                `;
                carousel.appendChild(item);

                const btn = document.createElement('button');
                btn.type='button';
                if(i===0) btn.className='active';
                btn.setAttribute('data-bs-target','#heroCarousel');
                btn.setAttribute('data-bs-slide-to',String(i));
                indicators.appendChild(btn);
            });
        })();

        const housesContainer = document.getElementById('housesContainer');
        const totalHousesEl = document.getElementById('totalHouses');
        const totalCitiesEl = document.getElementById('totalCities');
        const statHouses = document.getElementById('statHouses');
        const statCities = document.getElementById('statCities');
        const minPriceEl = document.getElementById('minPrice');
        const maxPriceEl = document.getElementById('maxPrice');

        function renderHouses(list){
            housesContainer.innerHTML = '';
            list.forEach(h => {
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4 mb-4';
                col.innerHTML = `
                    <article class="card-house bg-white">
                        <img loading="lazy" src="${h.images[0]}" alt="${h.title}" class="house-thumb">
                        <div class="p-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="mb-0">${h.title}</h5>
                                <span class="tag text-uppercase">${h.type}</span>
                            </div>
                            <p class="text-muted small mb-2">${h.city} — ${h.area} m²</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <strong>€${h.price.toLocaleString()}</strong>
                                <div>
                                    <button class="btn btn-sm btn-outline-primary me-1" data-id="${h.id}" data-action="details">Ver Detalhes</button>
                                    <button class="btn btn-sm btn-outline-secondary" data-id="${h.id}" data-action="fav"><i class="fa-regular fa-heart"></i></button>
                                </div>
                            </div>
                        </div>
                    </article>
                `;
                housesContainer.appendChild(col);
            });
            totalHousesEl.textContent = list.length;
            const cities = [...new Set(list.map(x=>x.city))];
            totalCitiesEl.textContent = cities.length;
            statHouses.textContent = houses.length;
            statCities.textContent = cities.length;
            const prices = list.map(x=>x.price);
            minPriceEl.textContent = prices.length? '€'+Math.min(...prices).toLocaleString(): '—';
            maxPriceEl.textContent = prices.length? '€'+Math.max(...prices).toLocaleString(): '—';
        }

        renderHouses(houses);

        document.querySelectorAll('.filters [data-filter]').forEach(btn=>{
            btn.addEventListener('click', ()=>{
                document.querySelectorAll('.filters [data-filter]').forEach(b=>b.classList.remove('active'));
                btn.classList.add('active');
                applyListState();
            });
        });

        document.getElementById('searchInput').addEventListener('input', applyListState);
        document.getElementById('sortSelect').addEventListener('change', applyListState);

        function applyListState(){
            const search = document.getElementById('searchInput').value.toLowerCase();
            const activeFilter = document.querySelector('.filters .active')?.getAttribute('data-filter') || 'all';
            let list = houses.filter(h => {
                if(activeFilter!=='all' && h.type!==activeFilter) return false;
                if(!search) return true;
                return h.title.toLowerCase().includes(search) || h.city.toLowerCase().includes(search) || String(h.price).includes(search);
            });
            const sort = document.getElementById('sortSelect').value;
            if(sort==='price-asc') list.sort((a,b)=>a.price-b.price);
            if(sort==='price-desc') list.sort((a,b)=>b.price-a.price);
            if(sort==='area-desc') list.sort((a,b)=>b.area-a.area);
            renderHouses(list);
        }

        const houseModal = new bootstrap.Modal(document.getElementById('houseModal'));
        document.body.addEventListener('click', (e)=>{
            const btn = e.target.closest('button');
            if(!btn) return;
            const id = btn.getAttribute('data-id');
            const action = btn.getAttribute('data-action');
            if(!id) return;
            const h = houses.find(x=>String(x.id)===id);
            if(action==='details') openDetails(h);
            if(action==='fav') toggleFav(h,btn);
        });

        let favorites = JSON.parse(localStorage.getItem('favHouses')||'[]');
        function updateFavCount(){document.getElementById('favCount').textContent = favorites.length}
        updateFavCount();

        function toggleFav(h,btn){
            const idx = favorites.indexOf(h.id);
            if(idx===-1) favorites.push(h.id); else favorites.splice(idx,1);
            localStorage.setItem('favHouses',JSON.stringify(favorites));
            updateFavCount();
            const icon = btn.querySelector('i');
            if(icon) icon.classList.toggle('fa-solid');
        }

        function openDetails(h){
            document.getElementById('modalTitle').textContent = h.title+' — '+h.city;
            document.getElementById('modalDesc').textContent = h.desc;
            const specs = document.getElementById('modalSpecs'); specs.innerHTML = '';
            specs.innerHTML = `<li>Preço: €${h.price.toLocaleString()}</li><li>Área: ${h.area} m²</li><li>Tipo: ${h.type}</li>`;
            const inner = document.querySelector('#modalCarousel .carousel-inner'); inner.innerHTML='';
            h.images.forEach((src,i)=>{
                const it = document.createElement('div'); it.className='carousel-item'+(i===0?' active':'');
                it.innerHTML = `<img src="${src}" class="d-block w-100" style="height:420px;object-fit:cover" loading="lazy">`;
                inner.appendChild(it);
            });
            houseModal.show();
        }

        document.getElementById('openFavorites').addEventListener('click', ()=>{
            const list = houses.filter(h=>favorites.includes(h.id));
            if(!list.length) return alert('Nenhum favorito.');
            renderHouses(list);
            window.location.href = '#homes';
        });

        function genCaptcha(){
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let out=''; for(let i=0;i<6;i++) out+=chars.charAt(Math.floor(Math.random()*chars.length));
            return out;
        }
        let currentCaptcha = genCaptcha();
        document.getElementById('captchaCode').textContent = currentCaptcha;
        document.getElementById('refreshCaptcha').addEventListener('click', ()=>{
            currentCaptcha = genCaptcha(); document.getElementById('captchaCode').textContent = currentCaptcha;
        });

        document.getElementById('contactForm').addEventListener('submit', function(e){
            e.preventDefault();
            const val = document.getElementById('captchaInput').value.trim();
            if(val!==currentCaptcha){ alert('CAPTCHA incorreto. Tente novamente.'); currentCaptcha = genCaptcha(); document.getElementById('captchaCode').textContent = currentCaptcha; return; }
            alert('Mensagem enviada (simulação). Obrigado!');
            this.reset(); currentCaptcha = genCaptcha(); document.getElementById('captchaCode').textContent = currentCaptcha;
        });

        /* ---------------- Quiz logic (improved) ---------------- */
        const quizQuestions = [
            {q:'O que faz o operador === em JavaScript?', options:['Apenas comparação de valor','Comparação de valor e tipo','Atribuição','Nada'], a:1, explain:'=== compara valor e tipo, sem coerção de tipo.'},
            {q:'Como declaras uma função em ES6 com arrow?', options:['function fn() {}','const fn = () => {}','let fn := {}','fn => {}'], a:1, explain:'Sintaxe de arrow function: const fn = () => {}.'},
            {q:'Qual método converte um objeto em JSON string?', options:['JSON.parse','JSON.stringify','toString','Object.toJSON'], a:1, explain:'JSON.stringify converte em string JSON.'},
            {q:'Qual palavra-chave define uma constante?', options:['var','let','const','static'], a:2, explain:'const declara uma constante cujo binding não muda.'},
            {q:'Qual método devolve o comprimento de um array?', options:['arr.count','arr.size','arr.length','arr.len'], a:2, explain:'A propriedade length devolve o comprimento.'}
        ];

        let quizState = { index:0, score:0, answers:[], timeLeft:20, timerId:null };

        function updateProgress(){
            const el = document.getElementById('quizProgressBar');
            const pct = Math.round((quizState.index / quizQuestions.length)*100);
            el.style.width = pct + '%';
            document.getElementById('quizProgress').textContent = `Questão ${Math.min(quizState.index+1, quizQuestions.length)} / ${quizQuestions.length}`;
            document.getElementById('score').textContent = quizState.score;
        }

        function startTimer(){
            clearInterval(quizState.timerId);
            quizState.timeLeft = 20;
            document.getElementById('timer').textContent = formatTime(quizState.timeLeft);
            quizState.timerId = setInterval(()=>{
                quizState.timeLeft--;
                document.getElementById('timer').textContent = formatTime(quizState.timeLeft);
                if(quizState.timeLeft<=0){ clearInterval(quizState.timerId); autoNext(); }
            },1000);
        }

        function formatTime(s){ const mm = Math.floor(s/60).toString().padStart(2,'0'); const ss = String(Math.max(0,s%60)).padStart(2,'0'); return `${mm}:${ss}` }

        function showQuestion(){
            clearInterval(quizState.timerId);
            const area = document.getElementById('quizQuestionArea'); area.innerHTML='';
            const q = quizQuestions[quizState.index];
            const h = document.createElement('h5'); h.textContent = q.q; area.appendChild(h);
            const list = document.createElement('div'); list.className = 'mt-3';
            q.options.forEach((opt,i)=>{
                const div = document.createElement('div'); div.className='option mb-2'; div.textContent = opt; div.dataset.idx=i;
                div.addEventListener('click', ()=>{
                    document.querySelectorAll('.option').forEach(o=>o.classList.remove('selected'));
                    div.classList.add('selected');
                    quizState.selected = i;
                });
                list.appendChild(div);
            });
            area.appendChild(list);
            document.getElementById('quizHint').textContent = '';
            updateProgress();
            startTimer();
        }

        function autoNext(){
            const q = quizQuestions[quizState.index];
            const s = typeof quizState.selected==='number' ? quizState.selected : null;
            const correct = q.a;
            if(s===correct) quizState.score += 10;
            quizState.answers.push({q:quizState.index, selected:s, correct});
            showFeedbackAndMove();
        }

        function showFeedbackAndMove(){
            clearInterval(quizState.timerId);
            const opts = document.querySelectorAll('.option');
            const correctIdx = quizQuestions[quizState.index].a;
            opts.forEach(o=>{
                const idx = Number(o.dataset.idx);
                if(idx===correctIdx) o.classList.add('correct');
                if(o.classList.contains('selected') && idx!==correctIdx) o.classList.add('wrong');
            });
            // show explanation
            document.getElementById('quizHint').textContent = quizQuestions[quizState.index].explain || '';
            setTimeout(()=>{
                quizState.index++;
                delete quizState.selected;
                if(quizState.index >= quizQuestions.length){ finishQuiz(); } else { showQuestion(); }
            },1200);
        }

        function finishQuiz(){
            clearInterval(quizState.timerId);
            document.getElementById('score').textContent = quizState.score;
            // summary
            const sum = document.getElementById('quizSummary'); sum.innerHTML='';
            quizState.answers.forEach(a=>{
                const li = document.createElement('li');
                const q = quizQuestions[a.q];
                li.textContent = `${q.q} — Sua resposta: ${q.options[a.selected] ?? 'Sem resposta'} — Correta: ${q.options[a.correct]}`;
                sum.appendChild(li);
            });
            // confetti simple
            triggerConfetti();
            alert('Quiz terminado! Pontuação: ' + quizState.score);
        }

        function triggerConfetti(){
            const el = document.getElementById('confetti');
            el.innerHTML='';
            for(let i=0;i<40;i++){
                const c = document.createElement('div');
                const size = Math.random()*8+6;
                c.style.position='fixed'; c.style.left = Math.random()*100+'%'; c.style.top = '-10px';
                c.style.width = size+'px'; c.style.height = size+'px';
                c.style.background = i%2? 'rgba(11,94,215,0.9)':'rgba(13,202,240,0.9)';
                c.style.borderRadius='2px'; c.style.zIndex=9999; c.style.opacity=0.95;
                c.style.transition='transform 2.5s linear, top 2.5s linear, opacity 500ms linear';
                document.body.appendChild(c);
                setTimeout(()=>{ c.style.top = (80+Math.random()*40)+'%'; c.style.transform = `rotate(${Math.random()*720}deg)`; c.style.opacity='0'; },10);
                setTimeout(()=>{ c.remove(); },2800);
            }
        }

        document.getElementById('nextBtn').addEventListener('click', ()=>{
            const s = quizState.selected;
            if(typeof s==='undefined') return alert('Escolha uma opção.');
            const correct = quizQuestions[quizState.index].a;
            if(s===correct) quizState.score += 10;
            quizState.answers.push({q:quizState.index, selected:s, correct});
            showFeedbackAndMove();
        });

        document.getElementById('restartBtn').addEventListener('click', ()=>{quizState = {index:0,score:0,answers:[],timeLeft:20,timerId:null}; showQuestion();});

        function formatSummary(){
            // placeholder for potential extended summary
        }

        document.addEventListener('DOMContentLoaded', ()=>{ renderHouses(houses); showQuestion(); });
    </script>
</body>
</html>